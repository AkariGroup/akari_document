******************************
トピック通信をしてみよう
******************************

ROS2でのトピック通信について、AKARIを使って解説していきます。

.. note::

   | こちらはROS2を使ったバージョンです。
   | ROSに慣れている方、使ってみたい方はこちらを推奨します。
   | ROSの使用、未使用の環境切り替え方法は :doc:`../troubleshoot/ros_switch` を参照してください。

.. note::

   新規ターミナルを起動する際に下記のターミナルの機能選択画面が表示される場合、本ページではすべて「2:ROS2」を選択します。
   2を入力し、enterを押してください。

   .. image:: ../images/terminal_function.png

==============================================
トピックについて
==============================================

トピックのおさらいです。

| **トピック(topic)**
| 一方向のメッセージの送信/受信をする方法です。
| 送信者を **パブリッシャ(publisher)** 、受信者を **サブスクライバ(subscriber)** といいます。
| パブリッシャはサブスクライバの状態を気にせず自分のタイミングでメッセージを発信(パブリッシュ)しており、そのトピックを受信(サブスクライブ)するかはサブスクライバが決定します。
| 複数のサブスクライバが同時に受信することも可能です。

   .. image:: ../images/ros2_topic.gif
      :scale: 30%

| AKARIでは画像、センサデータをトピックとしてパブリッシュしています。
| まずはAKARIでパブリッシュされているトピックを一覧で確認してみましょう。
| ターミナルを立ち上げて下記のコマンドを実行します。


.. code-block:: bash

   ros2 topic list

下記のように現在パブリッシュされているトピック名の一覧が表示されます。

   .. image:: ../images/topic_list.png
      :scale: 80%

これらのトピックをサブスクライブして中身を見てみましょう。

==============================================
トピックをサブスクライブしよう
==============================================

| まずはM5のセンサデータをサブスクライブして内容を確認してみましょう。
| ターミナルを立ち上げて下記のコマンドを実行します。
| 今回は/m5というトピックをサブスクライブします。

.. code-block:: bash

   ros2 topic echo /m5

| *ros2 topic echo* でトピックをサブスクライブし、表示することができます。 */m5* がサブスクライブするトピック名です。
| これを実行するとボタンやGPIOピンの状態、センサデータがリアルタイムで確認できると思います。
| このように、トピックはコマンドライン上でもサブスクライブすることができます。

==============================================
画像トピックをサブスクライブしよう
==============================================

| 次に、AKARIのカメラ画像をサブスクライブしてみます。
| ターミナルを立ち上げて下記のコマンドを実行します。

.. code-block:: bash

   ros2 run rqt_image_view rqt_image_view /image_raw

| *ros2 run* はros2のノードを起動するためのコマンドです。
| １つ目の引数はパッケージ名、2つ目の引数はターゲット名ですが、今回はどちらも*rqt_image_view* です。
| *rqt_image_view* はros2で画像トピックを確認するためのビューアです。
| 3つ目の引数はトピック名で、AKARIの画像トピック名は */image_raw* です。
| これを実行すると、新たなウィンドウが立ち上がりAKARIのカメラ映像が見られると思います。

|
:doc:`ros2_topic_app` へ進む

:doc:`ros2_akari_design` へ戻る
